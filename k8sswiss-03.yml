---
  - hosts: kube-master
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes/master, tags: master }
      - { role: kubernetes/client, tags: client }
      - { role: kubernetes-apps/cluster_roles, tags: cluster-roles }
  
  - hosts: k8s-cluster
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes/kubeadm, tags: kubeadm, when: "kubeadm_enabled" }
      - { role: network_plugin, tags: network }

  - hosts: kube-master[0]
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes-apps/rotate_tokens, tags: rotate_tokens, when: "secret_changed|default(false)" }

  - hosts: kube-master
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes-apps/network_plugin, tags: network }
      - { role: kubernetes-apps/policy_controller, tags: policy-controller }
      - { role: kubernetes-apps/ingress_controller, tags: ingress-controller }
      - { role: kubernetes-apps/external_provisioner, tags: external-provisioner }