---
  - hosts: calico-rr
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: network_plugin/calico/rr, tags: network }

  - hosts: k8s-cluster
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: dnsmasq, when: "dns_mode == 'dnsmasq_kubedns'", tags: dnsmasq }
      - { role: kubernetes/preinstall, when: "dns_mode != 'none' and resolvconf_mode == 'host_resolvconf'", tags: resolvconf }
    environment: "{{proxy_env}}"
  
  - hosts: kube-master[0]
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes-apps, tags: apps }