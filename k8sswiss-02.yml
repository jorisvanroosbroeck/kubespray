---
  - hosts: etcd
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: etcd, tags: etcd, etcd_cluster_setup: true, etcd_events_cluster_setup: true }
  
  - hosts: k8s-cluster:calico-rr
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: etcd, tags: etcd, etcd_cluster_setup: false, etcd_events_cluster_setup: false }
  
  - hosts: etcd:k8s-cluster:vault:calico-rr
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: vault, tags: vault, when: "cert_management == 'vault'"}
    environment: "{{proxy_env}}"
  
  - hosts: k8s-cluster
    any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
    roles:
      - { role: kubespray-defaults}
      - { role: kubernetes/node, tags: node }
    environment: "{{proxy_env}}"